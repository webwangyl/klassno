### 路由守卫跳转问题

**前提**：路由插件(vue-router)

**问题**：路由守卫跳转没用？

**尝试**：

​		1、大概写下出现路由守卫的判断逻辑

```
router.beforeEach(async (to, from, next) => {
  	if (!license) {
      	发送请求获取license
        返回 0  ->  next()
      	返回 其他 -> next('/license')
    }
  	if (权限) {
      	if (to.path in 权限) {
          	next()
        } else {
          	next('/404') // 问题在这里不跳转
        }
    } else {
      	next('/login')
    }
})
```

​		2、由于转成微前端发现了这个问题，所以注释掉微前端相关，没卵用。

​		3、打印是否在权限列表中的判断条件是否正确，判断逻辑没有问题。

​		4、尝试其他的next('/login')是否有用，发现都没有用！怀疑是不是nuxt项目中路由守卫的使用方式不对，查看了以前的项目，又百度搜了搜，发现写法上没有问题。

​		5、直接在路由守卫第一行跳转到login，报错超出堆栈，证明next('/login')是可以用的，一时间陷入自我怀疑。

​		6、峰回路转，突然看到了async，顿时联想到是不是同步异步在搞鬼，删掉发送请求的阶段，果然可以跳转了。

​		7、原因就在进入页面时，没有从存储中获取license，导致总是会发送请求，然后响应的时候走了next()。

**分析**：同步异步问题。

**警示**：

​		1、很明显发现我的判断条件有问题，可以同时进入两个分支，当时是因为觉得反正进入了一个分支就会next()掉，但是因为这是异步的，所以就出问题了。

​		2、同步异步在一起时，一定要注意执行顺序问题！那么多题白做了！严厉批评！